<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.team.supplychain.controllers.ManagerDashboardController"
            prefHeight="700.0" prefWidth="1400.0"
            stylesheets="@../css/styles.css, @../css/dashboard-manager.css">

    <!-- TOP: Modern Header Section -->
    <top>
        <HBox styleClass="top-bar-modern" alignment="CENTER_LEFT" spacing="20">
            <padding>
                <Insets top="20" right="30" bottom="20" left="30"/>
            </padding>

            <VBox spacing="2">
                <Label text="Operations Hub" styleClass="app-title-modern">
                    <font>
                        <Font name="System Bold" size="22.0" />
                    </font>
                </Label>
                <Label text="Manage operations and track performance" styleClass="app-subtitle">
                    <font>
                        <Font size="12.0" />
                    </font>
                </Label>
            </VBox>

            <Region HBox.hgrow="ALWAYS"/>

            <!-- Search Bar -->
            <HBox alignment="CENTER" styleClass="search-container" spacing="10">
                <Label text="ðŸ”" styleClass="search-icon">
                    <font>
                        <Font size="16.0" />
                    </font>
                </Label>
                <TextField promptText="Search..." styleClass="search-field" prefWidth="200"/>
            </HBox>

            <!-- User Profile Area -->
            <HBox alignment="CENTER" spacing="15">
                <!-- Notification Bell -->
                <Button fx:id="notificationsButton" text="ðŸ””" styleClass="notification-icon" onAction="#handleNotifications">
                    <font>
                        <Font size="18.0" />
                    </font>
                </Button>

                <!-- User Info -->
                <VBox alignment="CENTER_RIGHT" spacing="3">
                    <Label fx:id="currentUserLabel" text="Welcome, Manager!" styleClass="welcome-text-modern">
                        <font>
                            <Font name="System Bold" size="14.0" />
                        </font>
                    </Label>
                    <Label text="Role: Manager" styleClass="role-text-modern">
                        <font>
                            <Font size="12.0" />
                        </font>
                    </Label>
                </VBox>

                <!-- User Avatar -->
                <StackPane styleClass="user-avatar">
                    <Label text="ðŸ‘¤" styleClass="avatar-icon">
                        <font>
                            <Font size="20.0" />
                        </font>
                    </Label>
                </StackPane>

                <Button fx:id="logoutButton" text="Logout" styleClass="logout-button-modern"
                        onAction="#handleLogout">
                    <font>
                        <Font size="13.0" />
                    </font>
                </Button>
            </HBox>
        </HBox>
    </top>

    <!-- LEFT: Modern Sidebar Menu -->
    <left>
        <VBox styleClass="sidebar-modern" spacing="8" prefWidth="280">
            <padding>
                <Insets top="25" right="15" bottom="25" left="15"/>
            </padding>

            <!-- Logo Section -->
            <VBox alignment="CENTER" spacing="10" styleClass="logo-section">
                <padding>
                    <Insets bottom="20"/>
                </padding>
                <Label text="ðŸ“¦" styleClass="logo-icon">
                    <font>
                        <Font size="40.0" />
                    </font>
                </Label>
                <Label text="SCMS Manager" styleClass="logo-text">
                    <font>
                        <Font name="System Bold" size="16.0" />
                    </font>
                </Label>
            </VBox>

            <Separator styleClass="menu-separator"/>

            <Label text="NAVIGATION" styleClass="menu-header-modern">
                <font>
                    <Font name="System Bold" size="11.0" />
                </font>
                <VBox.margin>
                    <Insets top="15" bottom="10"/>
                </VBox.margin>
            </Label>

            <!-- Menu Buttons -->
            <Button text="  Inventory Management" styleClass="menu-button-modern" onAction="#handleInventory"
                    maxWidth="Infinity" graphicTextGap="15">
                <graphic>
                    <Label text="ðŸ“¦" styleClass="menu-icon">
                        <font>
                            <Font size="18.0" />
                        </font>
                    </Label>
                </graphic>
                <font>
                    <Font size="14.0" />
                </font>
            </Button>

            <Button text="  Purchase Orders" styleClass="menu-button-modern" onAction="#handlePurchaseOrders"
                    maxWidth="Infinity" graphicTextGap="15">
                <graphic>
                    <Label text="ðŸšš" styleClass="menu-icon">
                        <font>
                            <Font size="18.0" />
                        </font>
                    </Label>
                </graphic>
                <font>
                    <Font size="14.0" />
                </font>
            </Button>

            <Button text="  Attendance Tracking" styleClass="menu-button-modern" onAction="#handleAttendance"
                    maxWidth="Infinity" graphicTextGap="15">
                <graphic>
                    <Label text="ðŸ“‹" styleClass="menu-icon">
                        <font>
                            <Font size="18.0" />
                        </font>
                    </Label>
                </graphic>
                <font>
                    <Font size="14.0" />
                </font>
            </Button>

            <Button text="  Employee Management" styleClass="menu-button-modern" onAction="#handleEmployees"
                    maxWidth="Infinity" graphicTextGap="15">
                <graphic>
                    <Label text="ðŸ‘¥" styleClass="menu-icon">
                        <font>
                            <Font size="18.0" />
                        </font>
                    </Label>
                </graphic>
                <font>
                    <Font size="14.0" />
                </font>
            </Button>

            <Separator styleClass="menu-separator">
                <VBox.margin>
                    <Insets top="10" bottom="10"/>
                </VBox.margin>
            </Separator>

            <Label text="ANALYTICS" styleClass="menu-header-modern">
                <font>
                    <Font name="System Bold" size="11.0" />
                </font>
                <VBox.margin>
                    <Insets bottom="10"/>
                </VBox.margin>
            </Label>

            <Button text="  Reports &amp; Analytics" styleClass="menu-button-modern" onAction="#handleReports"
                    maxWidth="Infinity" graphicTextGap="15">
                <graphic>
                    <Label text="ðŸ“Š" styleClass="menu-icon">
                        <font>
                            <Font size="18.0" />
                        </font>
                    </Label>
                </graphic>
                <font>
                    <Font size="14.0" />
                </font>
            </Button>

            <Region VBox.vgrow="ALWAYS"/>

            <!-- Quick Stats Card -->
            <VBox styleClass="user-info-card" spacing="10">
                <padding>
                    <Insets top="15" right="15" bottom="15" left="15"/>
                </padding>
                <Label text="Today's Summary" styleClass="user-info-email">
                    <font>
                        <Font name="System Bold" size="11.0" />
                    </font>
                </Label>
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <Label text="âœ“" styleClass="user-status">
                        <font>
                            <Font size="12.0" />
                        </font>
                    </Label>
                    <Label text="All Systems Operational" styleClass="user-status">
                        <font>
                            <Font size="10.0" />
                        </font>
                    </Label>
                </HBox>
            </VBox>
        </VBox>
    </left>

    <!-- CENTER: Main Dashboard Content -->
    <center>
        <ScrollPane fx:id="centerScrollPane" fitToWidth="true" fitToHeight="true" styleClass="content-scroll">
            <VBox spacing="30" styleClass="content-area-modern">
                <padding>
                    <Insets top="30" right="30" bottom="30" left="30"/>
                </padding>

                <!-- Welcome Section -->
                <VBox spacing="10">
                    <Label text="Manager Dashboard" styleClass="welcome-message-modern">
                        <font>
                            <Font name="System Bold" size="28.0" />
                        </font>
                    </Label>
                    <Label text="Monitor operations and track key performance metrics" styleClass="subtitle-modern">
                        <font>
                            <Font size="15.0" />
                        </font>
                    </Label>
                </VBox>

                <!-- ROW 1: Key Operations Metrics -->
                <HBox spacing="20" alignment="CENTER">
                    <!-- Inventory Summary Card -->
                    <VBox styleClass="stat-card-modern" spacing="15" HBox.hgrow="ALWAYS">
                        <padding>
                            <Insets top="25" right="30" bottom="25" left="30"/>
                        </padding>
                        <Label text="Inventory Health" styleClass="stat-label-modern">
                            <font>
                                <Font size="13.0" />
                            </font>
                        </Label>
                        <HBox alignment="CENTER_LEFT" spacing="15">
                            <VBox styleClass="stat-icon-container stat-icon-blue">
                                <Label text="ðŸ“Š" styleClass="stat-icon-modern">
                                    <font>
                                        <Font size="32.0" />
                                    </font>
                                </Label>
                            </VBox>
                            <VBox spacing="5">
                                <Label fx:id="inventorySummaryLabel" text="95%" styleClass="stat-value-modern">
                                    <font>
                                        <Font name="System Bold" size="32.0" />
                                    </font>
                                </Label>
                                <Label text="Items at optimal level" styleClass="stat-change-positive">
                                    <font>
                                        <Font size="11.0" />
                                    </font>
                                </Label>
                            </VBox>
                        </HBox>
                        <ProgressBar fx:id="inventoryHealthBar" progress="0.95" styleClass="po-progress-bar" maxWidth="Infinity"/>
                    </VBox>

                    <!-- On-Site Employees Card -->
                    <VBox styleClass="stat-card-modern" spacing="15" HBox.hgrow="ALWAYS">
                        <padding>
                            <Insets top="25" right="30" bottom="25" left="30"/>
                        </padding>
                        <Label text="On-Site Employees" styleClass="stat-label-modern">
                            <font>
                                <Font size="13.0" />
                            </font>
                        </Label>
                        <HBox alignment="CENTER_LEFT" spacing="15">
                            <VBox styleClass="stat-icon-container stat-icon-green">
                                <Label text="ðŸ‘·" styleClass="stat-icon-modern">
                                    <font>
                                        <Font size="32.0" />
                                    </font>
                                </Label>
                            </VBox>
                            <VBox spacing="5">
                                <Label fx:id="onSiteEmployeesLabel" text="18" styleClass="stat-value-modern">
                                    <font>
                                        <Font name="System Bold" size="32.0" />
                                    </font>
                                </Label>
                                <Label text="Currently checked in" styleClass="stat-change-positive">
                                    <font>
                                        <Font size="11.0" />
                                    </font>
                                </Label>
                            </VBox>
                        </HBox>
                        <Button text="View Attendance" styleClass="action-button-secondary" onAction="#handleViewAttendance">
                            <font>
                                <Font size="12.0" />
                            </font>
                        </Button>
                    </VBox>

                    <!-- Purchase Orders in Transit Card -->
                    <VBox styleClass="stat-card-modern" spacing="15" HBox.hgrow="ALWAYS">
                        <padding>
                            <Insets top="25" right="30" bottom="25" left="30"/>
                        </padding>
                        <Label text="POs In Transit" styleClass="stat-label-modern">
                            <font>
                                <Font size="13.0" />
                            </font>
                        </Label>
                        <HBox alignment="CENTER_LEFT" spacing="15">
                            <VBox styleClass="stat-icon-container stat-icon-orange">
                                <Label text="ðŸšš" styleClass="stat-icon-modern">
                                    <font>
                                        <Font size="32.0" />
                                    </font>
                                </Label>
                            </VBox>
                            <VBox spacing="5">
                                <Label fx:id="posInTransitLabel" text="7" styleClass="stat-value-modern">
                                    <font>
                                        <Font name="System Bold" size="32.0" />
                                    </font>
                                </Label>
                                <Label text="Expected deliveries" styleClass="stat-change-positive">
                                    <font>
                                        <Font size="11.0" />
                                    </font>
                                </Label>
                            </VBox>
                        </HBox>
                        <Button text="Track Orders" styleClass="action-button-secondary" onAction="#handleTrackOrders">
                            <font>
                                <Font size="12.0" />
                            </font>
                        </Button>
                    </VBox>
                </HBox>

                <!-- ROW 2: Stock Levels Chart and Recent Activity -->
                <HBox spacing="20" alignment="TOP_CENTER">
                    <!-- Stock Levels Bar Chart -->
                    <VBox styleClass="stat-card-modern" spacing="15" HBox.hgrow="ALWAYS" prefWidth="550">
                        <padding>
                            <Insets top="25" right="25" bottom="25" left="25"/>
                        </padding>
                        <Label text="Stock Levels by Category" styleClass="section-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>
                        <BarChart fx:id="stockLevelsChart" legendVisible="false" animated="true" barGap="3" categoryGap="20">
                            <xAxis>
                                <CategoryAxis label="Product Category" side="BOTTOM"/>
                            </xAxis>
                            <yAxis>
                                <NumberAxis label="Stock %" side="LEFT" upperBound="100"/>
                            </yAxis>
                        </BarChart>
                    </VBox>

                    <!-- Recent Alerts & Actions Panel -->
                    <VBox styleClass="stat-card-modern" spacing="15" prefWidth="400">
                        <padding>
                            <Insets top="25" right="25" bottom="25" left="25"/>
                        </padding>
                        <Label text="Recent Alerts &amp; Actions" styleClass="section-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>

                        <VBox fx:id="recentActivityContainer" spacing="12" styleClass="activity-list">
                            <!-- Activity Item 1 -->
                            <HBox styleClass="activity-item, activity-item-warning" spacing="12" alignment="TOP_LEFT">
                                <padding>
                                    <Insets top="12" right="12" bottom="12" left="12"/>
                                </padding>
                                <Label text="âš " styleClass="activity-icon"/>
                                <VBox spacing="5" HBox.hgrow="ALWAYS">
                                    <Label text="Low Stock Alert" styleClass="activity-title"/>
                                    <Label text="Cheddar Cheese dropped below reorder level" styleClass="activity-description"/>
                                    <Label text="15 minutes ago" styleClass="activity-timestamp"/>
                                </VBox>
                            </HBox>

                            <!-- Activity Item 2 -->
                            <HBox styleClass="activity-item, activity-item-success" spacing="12" alignment="TOP_LEFT">
                                <padding>
                                    <Insets top="12" right="12" bottom="12" left="12"/>
                                </padding>
                                <Label text="âœ…" styleClass="activity-icon"/>
                                <VBox spacing="5" HBox.hgrow="ALWAYS">
                                    <Label text="PO #1245 Received" styleClass="activity-title"/>
                                    <Label text="Butter shipment arrived and checked in" styleClass="activity-description"/>
                                    <Label text="1 hour ago" styleClass="activity-timestamp"/>
                                </VBox>
                            </HBox>

                            <!-- Activity Item 3 -->
                            <HBox styleClass="activity-item, activity-item-info" spacing="12" alignment="TOP_LEFT">
                                <padding>
                                    <Insets top="12" right="12" bottom="12" left="12"/>
                                </padding>
                                <Label text="ðŸ“¦" styleClass="activity-icon"/>
                                <VBox spacing="5" HBox.hgrow="ALWAYS">
                                    <Label text="PO #1246 Shipped" styleClass="activity-title"/>
                                    <Label text="Greek Yogurt order on the way" styleClass="activity-description"/>
                                    <Label text="2 hours ago" styleClass="activity-timestamp"/>
                                </VBox>
                            </HBox>

                            <!-- Activity Item 4 -->
                            <HBox styleClass="activity-item, activity-item-info" spacing="12" alignment="TOP_LEFT">
                                <padding>
                                    <Insets top="12" right="12" bottom="12" left="12"/>
                                </padding>
                                <Label text="ðŸ‘¤" styleClass="activity-icon"/>
                                <VBox spacing="5" HBox.hgrow="ALWAYS">
                                    <Label text="Employee Check-In" styleClass="activity-title"/>
                                    <Label text="Ali Ibrahim checked in at Gate 1" styleClass="activity-description"/>
                                    <Label text="3 hours ago" styleClass="activity-timestamp"/>
                                </VBox>
                            </HBox>
                        </VBox>

                        <Button text="View All Activity" styleClass="action-button-primary" onAction="#handleViewAllActivity">
                            <font>
                                <Font size="13.0" />
                            </font>
                        </Button>
                    </VBox>
                </HBox>

                <!-- ROW 3: Purchase Orders in Progress with ETA -->
                <VBox styleClass="stat-card-modern" spacing="15">
                    <padding>
                        <Insets top="25" right="25" bottom="25" left="25"/>
                    </padding>
                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <Label text="Purchase Orders in Progress" styleClass="section-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="+ Create New PO" styleClass="action-button-primary" onAction="#handleCreatePO">
                            <font>
                                <Font size="13.0" />
                            </font>
                        </Button>
                    </HBox>

                    <VBox fx:id="posInProgressContainer" spacing="15">
                        <!-- PO Item 1 -->
                        <HBox styleClass="po-item" spacing="15" alignment="CENTER_LEFT">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="PO #1247" styleClass="po-number"/>
                                    <Label text="â€¢" styleClass="po-separator"/>
                                    <Label text="Al-Safi Dairy" styleClass="po-supplier"/>
                                </HBox>
                                <Label text="Whole Milk (500L) + Fresh Cream (200L)" styleClass="po-items"/>
                                <ProgressBar progress="0.67" maxWidth="Infinity" styleClass="po-progress-bar"/>
                            </VBox>
                            <VBox spacing="3" alignment="CENTER_RIGHT" minWidth="120">
                                <Label text="SHIPPED" styleClass="po-status, po-status-shipped"/>
                                <Label text="ETA: 15 min" styleClass="po-eta"/>
                            </VBox>
                        </HBox>

                        <!-- PO Item 2 -->
                        <HBox styleClass="po-item" spacing="15" alignment="CENTER_LEFT">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="PO #1248" styleClass="po-number"/>
                                    <Label text="â€¢" styleClass="po-separator"/>
                                    <Label text="Nadec" styleClass="po-supplier"/>
                                </HBox>
                                <Label text="Greek Yogurt (300 units)" styleClass="po-items"/>
                                <ProgressBar progress="0.33" maxWidth="Infinity" styleClass="po-progress-bar"/>
                            </VBox>
                            <VBox spacing="3" alignment="CENTER_RIGHT" minWidth="120">
                                <Label text="PREPARING" styleClass="po-status, po-status-preparing"/>
                                <Label text="ETA: 2h 45min" styleClass="po-eta"/>
                            </VBox>
                        </HBox>

                        <!-- PO Item 3 -->
                        <HBox styleClass="po-item" spacing="15" alignment="CENTER_LEFT">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="PO #1249" styleClass="po-number"/>
                                    <Label text="â€¢" styleClass="po-separator"/>
                                    <Label text="Dairy Valley" styleClass="po-supplier"/>
                                </HBox>
                                <Label text="Cheddar Cheese (150 kg)" styleClass="po-items"/>
                                <ProgressBar progress="0.0" maxWidth="Infinity" styleClass="po-progress-bar"/>
                            </VBox>
                            <VBox spacing="3" alignment="CENTER_RIGHT" minWidth="120">
                                <Label text="PENDING" styleClass="po-status, po-status-pending"/>
                                <Label text="Processing..." styleClass="po-eta"/>
                            </VBox>
                        </HBox>
                    </VBox>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

    <!-- BOTTOM: Modern Status Bar -->
    <bottom>
        <HBox styleClass="status-bar-modern" alignment="CENTER_LEFT" spacing="20">
            <padding>
                <Insets top="12" right="30" bottom="12" left="30"/>
            </padding>

            <HBox alignment="CENTER" spacing="8">
                <Label text="â—" styleClass="status-indicator">
                    <font>
                        <Font size="12.0" />
                    </font>
                </Label>
                <Label text="System Online" styleClass="status-text-modern">
                    <font>
                        <Font size="12.0" />
                    </font>
                </Label>
            </HBox>

            <Separator orientation="VERTICAL"/>

            <Label text="Database: Connected" styleClass="status-text-modern">
                <font>
                    <Font size="11.0" />
                </font>
            </Label>

            <Region HBox.hgrow="ALWAYS"/>

            <Label text="Version 1.0" styleClass="version-text">
                <font>
                    <Font size="11.0" />
                </font>
            </Label>

            <Separator orientation="VERTICAL"/>

            <Label text="Â© 2025 Supply Chain Management System" styleClass="copyright-text-modern">
                <font>
                    <Font size="10.0" />
                </font>
            </Label>
        </HBox>
    </bottom>

</BorderPane>
