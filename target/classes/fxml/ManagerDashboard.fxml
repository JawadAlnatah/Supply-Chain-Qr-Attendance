<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.team.supplychain.controllers.ManagerDashboardController"
            styleClass="dashboard-root"
            stylesheets="@../css/dashboard-manager.css">

    <!-- TOP: Header Section -->
    <top>
        <HBox styleClass="dashboard-header" alignment="CENTER_LEFT" spacing="20">
            <padding>
                <Insets top="20" right="30" bottom="20" left="30"/>
            </padding>

            <Label text="Operations Hub" styleClass="dashboard-title"/>

            <Region HBox.hgrow="ALWAYS"/>

            <Label fx:id="currentUserLabel" text="Manager: Mohammed Ali" styleClass="user-label"/>
            <Button fx:id="notificationsButton" text="ðŸ””" styleClass="icon-button" onAction="#handleNotifications"/>
            <Button fx:id="logoutButton" text="ðŸšª" styleClass="icon-button" onAction="#handleLogout"/>
        </HBox>
    </top>

    <!-- CENTER: Main Dashboard Content -->
    <center>
        <ScrollPane fitToWidth="true" fitToHeight="true" styleClass="dashboard-scroll">
            <VBox spacing="25" styleClass="dashboard-content">
                <padding>
                    <Insets top="30" right="30" bottom="30" left="30"/>
                </padding>

                <!-- ROW 1: Key Operations Metrics -->
                <HBox spacing="20" alignment="CENTER">
                    <!-- Inventory Summary Card -->
                    <VBox styleClass="dashboard-card, metric-card" spacing="10" HBox.hgrow="ALWAYS">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        <Label text="Inventory Summary" styleClass="card-title"/>
                        <HBox alignment="CENTER" spacing="10">
                            <Label text="ðŸ“Š" styleClass="metric-icon"/>
                            <Label fx:id="inventorySummaryLabel" text="95%" styleClass="metric-value"/>
                        </HBox>
                        <Label text="Items at optimal level" styleClass="card-subtitle"/>
                        <ProgressBar fx:id="inventoryHealthBar" progress="0.95" styleClass="health-progress-bar" maxWidth="Infinity"/>
                    </VBox>

                    <!-- On-Site Employees Card -->
                    <VBox styleClass="dashboard-card, metric-card" spacing="10" HBox.hgrow="ALWAYS">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        <Label text="On-Site Employees" styleClass="card-title"/>
                        <HBox alignment="CENTER" spacing="10">
                            <Label text="ðŸ‘·" styleClass="metric-icon"/>
                            <Label fx:id="onSiteEmployeesLabel" text="18" styleClass="metric-value"/>
                        </HBox>
                        <Label text="Currently checked in" styleClass="card-subtitle"/>
                        <Button text="View Attendance" styleClass="card-action-button" onAction="#handleViewAttendance"/>
                    </VBox>

                    <!-- Purchase Orders in Transit Card -->
                    <VBox styleClass="dashboard-card, metric-card" spacing="10" HBox.hgrow="ALWAYS">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        <Label text="POs In Transit" styleClass="card-title"/>
                        <HBox alignment="CENTER" spacing="10">
                            <Label text="ðŸšš" styleClass="metric-icon"/>
                            <Label fx:id="posInTransitLabel" text="7" styleClass="metric-value"/>
                        </HBox>
                        <Label text="Expected deliveries" styleClass="card-subtitle"/>
                        <Button text="Track Orders" styleClass="card-action-button" onAction="#handleTrackOrders"/>
                    </VBox>
                </HBox>

                <!-- ROW 2: Stock Levels Chart and Recent Activity -->
                <HBox spacing="20" alignment="TOP_CENTER">
                    <!-- Stock Levels Bar Chart -->
                    <VBox styleClass="dashboard-card, chart-card" spacing="15" HBox.hgrow="ALWAYS" prefWidth="550">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        <Label text="Stock Levels by Category" styleClass="card-title"/>
                        <BarChart fx:id="stockLevelsChart" legendVisible="false" animated="true" barGap="3" categoryGap="20">
                            <xAxis>
                                <CategoryAxis label="Product Category" side="BOTTOM"/>
                            </xAxis>
                            <yAxis>
                                <NumberAxis label="Stock %" side="LEFT" upperBound="100"/>
                            </yAxis>
                        </BarChart>
                    </VBox>

                    <!-- Recent Alerts & Actions Panel -->
                    <VBox styleClass="dashboard-card, activity-panel" spacing="15" prefWidth="380">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        <Label text="Recent Alerts &amp; Actions" styleClass="card-title"/>

                        <VBox fx:id="recentActivityContainer" spacing="12" styleClass="activity-list">
                            <!-- Activity Item 1 -->
                            <HBox styleClass="activity-item, activity-item-warning" spacing="12" alignment="TOP_LEFT">
                                <padding>
                                    <Insets top="12" right="12" bottom="12" left="12"/>
                                </padding>
                                <Label text="âš " styleClass="activity-icon"/>
                                <VBox spacing="5" HBox.hgrow="ALWAYS">
                                    <Label text="Low Stock Alert" styleClass="activity-title"/>
                                    <Label text="Cheddar Cheese dropped below reorder level" styleClass="activity-description"/>
                                    <Label text="15 minutes ago" styleClass="activity-timestamp"/>
                                </VBox>
                            </HBox>

                            <!-- Activity Item 2 -->
                            <HBox styleClass="activity-item, activity-item-success" spacing="12" alignment="TOP_LEFT">
                                <padding>
                                    <Insets top="12" right="12" bottom="12" left="12"/>
                                </padding>
                                <Label text="âœ…" styleClass="activity-icon"/>
                                <VBox spacing="5" HBox.hgrow="ALWAYS">
                                    <Label text="PO #1245 Received" styleClass="activity-title"/>
                                    <Label text="Butter shipment arrived and checked in" styleClass="activity-description"/>
                                    <Label text="1 hour ago" styleClass="activity-timestamp"/>
                                </VBox>
                            </HBox>

                            <!-- Activity Item 3 -->
                            <HBox styleClass="activity-item, activity-item-info" spacing="12" alignment="TOP_LEFT">
                                <padding>
                                    <Insets top="12" right="12" bottom="12" left="12"/>
                                </padding>
                                <Label text="ðŸ“¦" styleClass="activity-icon"/>
                                <VBox spacing="5" HBox.hgrow="ALWAYS">
                                    <Label text="PO #1246 Shipped" styleClass="activity-title"/>
                                    <Label text="Greek Yogurt order on the way" styleClass="activity-description"/>
                                    <Label text="2 hours ago" styleClass="activity-timestamp"/>
                                </VBox>
                            </HBox>

                            <!-- Activity Item 4 -->
                            <HBox styleClass="activity-item, activity-item-info" spacing="12" alignment="TOP_LEFT">
                                <padding>
                                    <Insets top="12" right="12" bottom="12" left="12"/>
                                </padding>
                                <Label text="ðŸ‘¤" styleClass="activity-icon"/>
                                <VBox spacing="5" HBox.hgrow="ALWAYS">
                                    <Label text="Employee Check-In" styleClass="activity-title"/>
                                    <Label text="Ali Ibrahim checked in at Gate 1" styleClass="activity-description"/>
                                    <Label text="3 hours ago" styleClass="activity-timestamp"/>
                                </VBox>
                            </HBox>
                        </VBox>

                        <Button text="View All Activity" styleClass="card-action-button-primary" onAction="#handleViewAllActivity"/>
                    </VBox>
                </HBox>

                <!-- ROW 3: Purchase Orders in Progress with ETA -->
                <VBox styleClass="dashboard-card, po-tracking-card" spacing="15">
                    <padding>
                        <Insets top="20" right="20" bottom="20" left="20"/>
                    </padding>
                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <Label text="Purchase Orders in Progress" styleClass="card-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="+ Create New PO" styleClass="create-po-button" onAction="#handleCreatePO"/>
                    </HBox>

                    <VBox fx:id="posInProgressContainer" spacing="15">
                        <!-- PO Item 1 -->
                        <HBox styleClass="po-item" spacing="15" alignment="CENTER_LEFT">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="PO #1247" styleClass="po-number"/>
                                    <Label text="â€¢" styleClass="po-separator"/>
                                    <Label text="Al-Safi Dairy" styleClass="po-supplier"/>
                                </HBox>
                                <Label text="Whole Milk (500L) + Fresh Cream (200L)" styleClass="po-items"/>
                                <ProgressBar progress="0.67" maxWidth="Infinity" styleClass="po-progress-bar"/>
                            </VBox>
                            <VBox spacing="3" alignment="CENTER_RIGHT" minWidth="120">
                                <Label text="SHIPPED" styleClass="po-status, po-status-shipped"/>
                                <Label text="ETA: 15 min" styleClass="po-eta"/>
                            </VBox>
                        </HBox>

                        <!-- PO Item 2 -->
                        <HBox styleClass="po-item" spacing="15" alignment="CENTER_LEFT">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="PO #1248" styleClass="po-number"/>
                                    <Label text="â€¢" styleClass="po-separator"/>
                                    <Label text="Nadec" styleClass="po-supplier"/>
                                </HBox>
                                <Label text="Greek Yogurt (300 units)" styleClass="po-items"/>
                                <ProgressBar progress="0.33" maxWidth="Infinity" styleClass="po-progress-bar"/>
                            </VBox>
                            <VBox spacing="3" alignment="CENTER_RIGHT" minWidth="120">
                                <Label text="PREPARING" styleClass="po-status, po-status-preparing"/>
                                <Label text="ETA: 2h 45min" styleClass="po-eta"/>
                            </VBox>
                        </HBox>

                        <!-- PO Item 3 -->
                        <HBox styleClass="po-item" spacing="15" alignment="CENTER_LEFT">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="PO #1249" styleClass="po-number"/>
                                    <Label text="â€¢" styleClass="po-separator"/>
                                    <Label text="Dairy Valley" styleClass="po-supplier"/>
                                </HBox>
                                <Label text="Cheddar Cheese (150 kg)" styleClass="po-items"/>
                                <ProgressBar progress="0.0" maxWidth="Infinity" styleClass="po-progress-bar"/>
                            </VBox>
                            <VBox spacing="3" alignment="CENTER_RIGHT" minWidth="120">
                                <Label text="PENDING" styleClass="po-status, po-status-pending"/>
                                <Label text="Processing..." styleClass="po-eta"/>
                            </VBox>
                        </HBox>
                    </VBox>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

    <!-- BOTTOM: Quick Action Bar -->
    <bottom>
        <HBox styleClass="dashboard-footer" spacing="15" alignment="CENTER">
            <padding>
                <Insets top="20" right="30" bottom="20" left="30"/>
            </padding>

            <Button text="ðŸ“¦ Inventory" styleClass="quick-action-button" onAction="#handleInventory"/>
            <Button text="ðŸšš Purchase Orders" styleClass="quick-action-button" onAction="#handlePurchaseOrders"/>
            <Button text="ðŸ“‹ Attendance" styleClass="quick-action-button" onAction="#handleAttendance"/>
            <Button text="ðŸ‘¥ Employees" styleClass="quick-action-button" onAction="#handleEmployees"/>
            <Button text="ðŸ“Š Reports" styleClass="quick-action-button" onAction="#handleReports"/>
        </HBox>
    </bottom>

</BorderPane>
